<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Chat API Interface</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    [v-cloak] {
      display: none;
    }

    .fade-enter-active,
    .fade-leave-active {
      transition: opacity 0.3s ease;
    }

    .fade-enter-from,
    .fade-leave-to {
      opacity: 0;
    }

    .slide-enter-active,
    .slide-leave-active {
      transition: all 0.3s ease;
    }

    .slide-enter-from {
      transform: translateY(-10px);
      opacity: 0;
    }

    .slide-leave-to {
      transform: translateY(10px);
      opacity: 0;
    }

    .notification {
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .code-block {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      background: #1a1a1a;
      border-radius: 8px;
      position: relative;
    }

    .typing-animation::after {
      content: '|';
      animation: blink 1s infinite;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      51%,
      100% {
        opacity: 0;
      }
    }

    .pulse-animation {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    .profile-item {
      transition: all 0.3s ease;
    }

    .profile-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(255, 255, 255, 0.1);
    }

    .model-option {
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .model-option:hover {
      transform: scale(1.02);
      background: rgba(255, 255, 255, 0.15);
    }

    .saved-config-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .saved-config-card:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.15);
    }
  </style>
</head>

<body class="min-h-screen gradient-bg">
  <div id="app" v-cloak>
    <!-- Notification Component -->
    <teleport to="body">
      <transition name="fade">
        <div v-if="notification.show" class="fixed top-4 right-4 z-50 max-w-md">
          <div class="notification bg-white rounded-lg shadow-2xl p-4 border-l-4" :class="{
                             'border-red-500': notification.type === 'error',
                             'border-green-500': notification.type === 'success',
                             'border-blue-500': notification.type === 'info',
                             'border-yellow-500': notification.type === 'warning'
                         }">
            <div class="flex items-start">
              <div class="flex-shrink-0">
                <i :class="{
                                    'fas fa-exclamation-circle text-red-500': notification.type === 'error',
                                    'fas fa-check-circle text-green-500': notification.type === 'success',
                                    'fas fa-info-circle text-blue-500': notification.type === 'info',
                                    'fas fa-exclamation-triangle text-yellow-500': notification.type === 'warning'
                                }"></i>
              </div>
              <div class="ml-3 flex-1">
                <p class="text-sm font-medium text-gray-900">
                  {{ notification.content }}
                </p>
              </div>
              <button @click="notification.show = false" class="ml-4 text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
      </transition>
    </teleport>

    <!-- Configuration Profiles Modal -->
    <teleport to="body">
      <transition name="fade">
        <div v-if="showProfilesModal"
          class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
          <div class="glass-effect rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-semibold text-white flex items-center">
                <i class="fas fa-save mr-3 text-green-300"></i>
                Configuration Profiles
              </h2>
              <button @click="showProfilesModal = false" class="text-gray-400 hover:text-white transition-colors">
                <i class="fas fa-times text-xl"></i>
              </button>
            </div>

            <!-- Save Current Profile -->
            <div class="mb-6 bg-white/5 rounded-lg p-4">
              <h3 class="text-lg font-medium text-white mb-3">Save Current Configuration</h3>
              <div class="flex gap-3">
                <input v-model="newProfileName" type="text" placeholder="Profile name..."
                  class="flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-indigo-200 focus:ring-2 focus:ring-blue-400" />
                <button @click="saveCurrentProfile" :disabled="!newProfileName.trim()"
                  class="px-6 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-500 text-white rounded-lg transition-colors font-medium">
                  <i class="fas fa-save mr-2"></i>Save
                </button>
              </div>
            </div>

            <!-- Saved Profiles -->
            <div v-if="Object.keys(savedProfiles).length > 0">
              <h3 class="text-lg font-medium text-white mb-4">Saved Profiles</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div v-for="(profile, key) in savedProfiles" :key="key"
                  class="saved-config-card bg-white/5 rounded-lg p-4 border border-white/10">
                  <div class="flex items-start justify-between mb-3">
                    <div class="flex-1">
                      <h4 class="font-medium text-white">{{ profile.name }}</h4>
                      <p class="text-sm text-indigo-200 mt-1">
                        Model: {{ profile.config.model }}
                      </p>
                      <p class="text-xs text-indigo-300 mt-1">
                        Saved: {{ formatDate(profile.timestamp) }}
                      </p>
                    </div>
                    <div class="flex gap-2">
                      <button @click="loadProfile(profile.config)"
                        class="text-blue-400 hover:text-blue-300 transition-colors" title="Load Profile">
                        <i class="fas fa-download"></i>
                      </button>
                      <button @click="deleteProfile(key)" class="text-red-400 hover:text-red-300 transition-colors"
                        title="Delete Profile">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>

                  <div class="text-sm text-gray-300 space-y-1">
                    <div class="flex justify-between">
                      <span>Temperature:</span>
                      <span>{{ profile.config.temperature }}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Max Tokens:</span>
                      <span>{{ profile.config.max_tokens }}</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Messages:</span>
                      <span>{{ profile.config.messages.length }}</span>
                    </div>
                  </div>

                  <button @click="loadProfile(profile.config)"
                    class="w-full mt-3 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded transition-colors font-medium">
                    Load Profile
                  </button>
                </div>
              </div>
            </div>
            <div v-else class="text-center py-8 text-gray-400">
              <i class="fas fa-folder-open text-4xl mb-3 opacity-50"></i>
              <p>No saved profiles yet. Save your current configuration to get started.</p>
            </div>
          </div>
        </div>
      </transition>
    </teleport>

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 max-w-7xl">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-white mb-4 flex items-center justify-center">
          <i class="fas fa-robot mr-3 text-yellow-300"></i>
          AI Chat API Interface Pro
        </h1>
        <p class="text-lg text-indigo-100">
          Advanced OpenAI API Testing & Configuration Management Platform
        </p>
      </div>

      <!-- Quick Actions Bar -->
      <div class="flex flex-wrap gap-4 mb-8 justify-center">
        <button @click="showProfilesModal = true"
          class="px-6 py-3 bg-green-500/20 hover:bg-green-500/30 border border-green-400/50 text-green-200 rounded-lg transition-all duration-200 font-medium">
          <i class="fas fa-save mr-2"></i>Manage Profiles
        </button>
        <button @click="resetConfiguration"
          class="px-6 py-3 bg-orange-500/20 hover:bg-orange-500/30 border border-orange-400/50 text-orange-200 rounded-lg transition-all duration-200 font-medium">
          <i class="fas fa-refresh mr-2"></i>Reset Config
        </button>
        <button @click="exportConfiguration"
          class="px-6 py-3 bg-purple-500/20 hover:bg-purple-500/30 border border-purple-400/50 text-purple-200 rounded-lg transition-all duration-200 font-medium">
          <i class="fas fa-download mr-2"></i>Export
        </button>
        <label
          class="px-6 py-3 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-400/50 text-blue-200 rounded-lg transition-all duration-200 font-medium cursor-pointer">
          <i class="fas fa-upload mr-2"></i>Import
          <input type="file" accept=".json" @change="importConfiguration" class="hidden" />
        </label>
      </div>

      <!-- Main Content -->
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        <!-- Configuration Panel -->
        <div class="xl:col-span-2 space-y-6">
          <!-- Basic Configuration -->
          <div class="glass-effect rounded-xl p-6">
            <h2 class="text-2xl font-semibold text-white mb-6 flex items-center">
              <i class="fas fa-cogs mr-3 text-blue-300"></i>
              API Configuration
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Left Column -->
              <div class="space-y-6">
                <!-- URL Input -->
                <div class="space-y-2">
                  <label class="block text-sm font-medium text-indigo-100">
                    <i class="fas fa-link mr-2"></i>API Endpoint *
                  </label>
                  <input v-model="config.url" type="url" placeholder="https://api.openai.com"
                    class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-indigo-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200" />
                  <p class="text-xs text-indigo-300">Enter your API base URL</p>
                </div>

                <!-- Token Input -->
                <div class="space-y-2">
                  <label class="block text-sm font-medium text-indigo-100">
                    <i class="fas fa-key mr-2"></i>API Token *
                  </label>
                  <div class="relative">
                    <input v-model="config.token" :type="showToken ? 'text' : 'password'" placeholder="sk-..."
                      class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-indigo-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200 pr-12" />
                    <button @click="showToken = !showToken"
                      class="absolute right-3 top-1/2 transform -translate-y-1/2 text-indigo-300 hover:text-white transition-colors">
                      <i :class="showToken ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                    </button>
                  </div>
                  <p class="text-xs text-indigo-300">Your API authentication token</p>
                </div>

                <!-- Custom Model Input -->
                <div class="space-y-2">
                  <label class="block text-sm font-medium text-indigo-100">
                    <i class="fas fa-brain mr-2"></i>Model *
                  </label>
                  <div class="relative">
                    <input v-model="config.model" type="text" placeholder="gpt-3.5-turbo"
                      class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-indigo-200 focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200"
                      list="model-suggestions" />
                    <datalist id="model-suggestions">
                      <option v-for="model in commonModels" :key="model" :value="model">
                    </datalist>
                  </div>
                  <p class="text-xs text-indigo-300">Type any model name or select from suggestions</p>
                </div>
              </div>

              <!-- Right Column -->
              <div class="space-y-6">
                <!-- Advanced Settings -->
                <div class="space-y-4">
                  <h3 class="text-lg font-medium text-white flex items-center">
                    <i class="fas fa-sliders-h mr-2 text-purple-300"></i>
                    Advanced Settings
                  </h3>

                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-indigo-100">
                      <i class="fas fa-thermometer-half mr-2"></i>Temperature
                      <span class="text-xs text-indigo-300 ml-2">({{ config.temperature }})</span>
                    </label>
                    <input v-model.number="config.temperature" type="range" min="0" max="2" step="0.1"
                      class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider" />
                    <div class="flex justify-between text-xs text-indigo-300">
                      <span>Conservative</span>
                      <span>Creative</span>
                    </div>
                  </div>

                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-indigo-100">
                      <i class="fas fa-sort-numeric-up mr-2"></i>Max Tokens
                    </label>
                    <input v-model.number="config.max_tokens" type="number" min="1" max="32000"
                      class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:ring-2 focus:ring-blue-400 transition-all duration-200" />
                  </div>

                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-indigo-100">
                      <i class="fas fa-percentage mr-2"></i>Top P
                      <span class="text-xs text-indigo-300 ml-2">({{ config.top_p }})</span>
                    </label>
                    <input v-model.number="config.top_p" type="range" min="0" max="1" step="0.1"
                      class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider" />
                  </div>

                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-indigo-100">
                      <i class="fas fa-ban mr-2"></i>Frequency Penalty
                      <span class="text-xs text-indigo-300 ml-2">({{ config.frequency_penalty }})</span>
                    </label>
                    <input v-model.number="config.frequency_penalty" type="range" min="-2" max="2" step="0.1"
                      class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider" />
                  </div>

                  <div class="space-y-2">
                    <label class="block text-sm font-medium text-indigo-100">
                      <i class="fas fa-minus-circle mr-2"></i>Presence Penalty
                      <span class="text-xs text-indigo-300 ml-2">({{ config.presence_penalty }})</span>
                    </label>
                    <input v-model.number="config.presence_penalty" type="range" min="-2" max="2" step="0.1"
                      class="w-full h-2 bg-white/20 rounded-lg appearance-none cursor-pointer slider" />
                  </div>
                </div>

                <!-- Stream Toggle -->
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                  <div class="flex items-center">
                    <i class="fas fa-stream mr-3 text-green-300"></i>
                    <div>
                      <span class="text-indigo-100 font-medium">Streaming Mode</span>
                      <p class="text-xs text-indigo-300">Real-time response streaming</p>
                    </div>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" v-model="config.stream" class="sr-only peer" />
                    <div
                      class="w-11 h-6 bg-white/20 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500">
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Messages Configuration -->
          <div class="glass-effect rounded-xl p-6">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-comments mr-3 text-green-300"></i>
                Conversation Messages
              </h3>
              <div class="flex gap-2">
                <button @click="addMessage"
                  class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors font-medium text-sm">
                  <i class="fas fa-plus mr-1"></i>Add
                </button>
                <button @click="clearAllMessages"
                  class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors font-medium text-sm">
                  <i class="fas fa-trash mr-1"></i>Clear
                </button>
              </div>
            </div>

            <div class="space-y-4 max-h-80 overflow-y-auto">
              <div v-for="(message, index) in config.messages" :key="index"
                class="bg-white/5 rounded-lg p-4 border border-white/10 message-item">
                <div class="flex items-center justify-between mb-3">
                  <select v-model="message.role"
                    class="px-3 py-2 bg-white/10 border border-white/20 rounded text-white text-sm min-w-[120px] focus:ring-2 focus:ring-blue-400">
                    <option class="text-gray-800" value="system">🔧 System</option>
                    <option class="text-gray-800" value="user">👤 User</option>
                    <option class="text-gray-800" value="assistant">🤖 Assistant</option>
                  </select>
                  <div class="flex items-center gap-2">
                    <span class="text-xs text-indigo-300">
                      {{ message.content.length }} chars
                    </span>
                    <button @click="duplicateMessage(index)" class="text-blue-400 hover:text-blue-300 transition-colors"
                      title="Duplicate message">
                      <i class="fas fa-copy"></i>
                    </button>
                    <button @click="removeMessage(index)" class="text-red-400 hover:text-red-300 transition-colors"
                      title="Remove message">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
                <textarea v-model="message.content" placeholder="Enter message content..." rows="3"
                  class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded text-white placeholder-indigo-200 focus:ring-2 focus:ring-blue-400 resize-none transition-all duration-200"></textarea>
              </div>
            </div>

            <div v-if="config.messages.length === 0" class="text-center py-8 text-gray-500">
              <i class="fas fa-comment-slash text-4xl mb-3 opacity-50"></i>
              <p>No messages configured. Add a message to get started.</p>
            </div>
          </div>

          <!-- Send Button -->
          <button @click="sendRequest" :disabled="isLoading || !canSendRequest"
            class="w-full px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 disabled:from-gray-400 disabled:to-gray-500 text-white rounded-lg font-semibold text-lg transition-all duration-200 transform hover:scale-[1.02] disabled:scale-100"
            :class="{ 'pulse-animation': isLoading }">
            <i v-if="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
            <i v-else class="fas fa-paper-plane mr-2"></i>
            {{ isLoading ? 'Processing...' : 'Send Request' }}
          </button>

          <!-- Validation Messages -->
          <div v-if="!canSendRequest && !isLoading" class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4">
            <div class="flex items-center text-yellow-200">
              <i class="fas fa-exclamation-triangle mr-2"></i>
              <span class="font-medium">Required fields missing:</span>
            </div>
            <ul class="mt-2 text-sm text-yellow-100 list-disc list-inside">
              <li v-if="!config.url.trim()">API Endpoint is required</li>
              <li v-if="!config.token.trim()">API Token is required</li>
              <li v-if="!config.model.trim()">Model is required</li>
              <li v-if="config.messages.length === 0">At least one message is required</li>
            </ul>
          </div>
        </div>

        <!-- Response Panel -->
        <div class="xl:col-span-1">
          <div class="glass-effect rounded-xl p-6 sticky top-8">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-reply mr-3 text-purple-300"></i>
                Response
              </h2>

              <!-- Tab Switcher -->
              <div class="flex bg-white/10 rounded-lg p-1">
                <button @click="tab = 'preview'"
                  :class="tab === 'preview' ? 'bg-white/20 text-white' : 'text-indigo-200 hover:text-white'"
                  class="px-3 py-2 rounded transition-all duration-200 text-sm">
                  <i class="fas fa-eye mr-1"></i>Preview
                </button>
                <button @click="tab = 'raw'"
                  :class="tab === 'raw' ? 'bg-white/20 text-white' : 'text-indigo-200 hover:text-white'"
                  class="px-3 py-2 rounded transition-all duration-200 text-sm">
                  <i class="fas fa-code mr-1"></i>Raw
                </button>
              </div>
            </div>

            <!-- Response Content -->
            <div class="bg-gray-900 rounded-lg p-4 min-h-[300px] max-h-[500px] overflow-y-auto">
              <transition name="fade" mode="out-in">
                <!-- Preview Tab -->
                <div v-if="tab === 'preview'" class="prose prose-invert max-w-none">
                  <div v-if="isLoading" class="flex items-center justify-center py-16">
                    <div class="text-center">
                      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mb-3"></div>
                      <p class="text-indigo-200 typing-animation text-sm">
                        Processing request
                      </p>
                    </div>
                  </div>
                  <div v-else-if="response" class="text-gray-100 whitespace-pre-wrap font-mono text-sm leading-relaxed">
                    {{ response }}
                  </div>
                  <div v-else class="text-center py-16 text-gray-500">
                    <i class="fas fa-comment-dots text-4xl mb-3 opacity-50"></i>
                    <p class="text-sm">
                      Response will appear here after sending a request
                    </p>
                  </div>
                </div>

                <!-- Raw Tab -->
                <div v-else class="code-block">
                  <div class="flex items-center justify-between bg-gray-800 px-3 py-2 rounded-t-lg">
                    <span class="text-gray-400 text-xs font-mono">JSON Response</span>
                    <button @click="copyToClipboard" class="text-gray-400 hover:text-white transition-colors text-sm"
                      :disabled="!response">
                      <i class="fas fa-copy"></i>
                    </button>
                  </div>
                  <pre v-if="response"
                    class="text-green-400 text-xs overflow-x-auto p-3 bg-gray-900"><code>{{ formatJSON(response) }}</code></pre>
                  <div v-else class="p-4 text-gray-500 text-center">
                    <i class="fas fa-file-code text-3xl mb-2 opacity-50"></i>
                    <p class="text-sm">Raw JSON response will appear here</p>
                  </div>
                </div>
              </transition>
            </div>

            <!-- Response Stats -->
            <div v-if="response" class="mt-4 grid grid-cols-2 gap-3 text-center">
              <div class="bg-white/5 rounded-lg p-3">
                <div class="text-lg font-semibold text-white">
                  {{ responseStats.characters }}
                </div>
                <div class="text-xs text-indigo-200">Characters</div>
              </div>
              <div class="bg-white/5 rounded-lg p-3">
                <div class="text-lg font-semibold text-white">
                  {{ responseStats.words }}
                </div>
                <div class="text-xs text-indigo-200">Words</div>
              </div>
            </div>

            <!-- Performance Stats -->
            <div v-if="responseTime" class="mt-3 bg-white/5 rounded-lg p-3 text-center">
              <div class="text-lg font-semibold text-white">
                {{ responseTime }}ms
              </div>
              <div class="text-xs text-indigo-200">Response Time</div>
            </div>

            <!-- Quick Actions -->
            <div v-if="response" class="mt-4 flex gap-2">
              <button @click="copyToClipboard"
                class="flex-1 px-3 py-2 bg-blue-500/20 border border-blue-400/50 text-blue-200 rounded-lg transition-colors text-sm">
                <i class="fas fa-copy mr-1"></i>Copy
              </button>
              <button @click="clearResponse"
                class="flex-1 px-3 py-2 bg-red-500/20 border border-red-400/50 text-red-200 rounded-lg transition-colors text-sm">
                <i class="fas fa-trash mr-1"></i>Clear
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="mt-8 text-center">
        <div class="glass-effect rounded-lg p-4">
          <p class="text-indigo-100 text-sm">
            <i class="fas fa-info-circle mr-2"></i>
            Built with Vue 3 Composition API & Tailwind CSS |
            <span class="text-blue-300">Data saved locally</span>
            |
            <span class="text-green-300">{{ Object.keys(savedProfiles).length }} Saved Profiles</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
      setup() {
        // Reactive State
        const config = reactive({
          url: 'https://api.openai.com',
          token: '',
          model: 'gpt-3.5-turbo',
          temperature: 0.7,
          max_tokens: 1000,
          top_p: 1.0,
          frequency_penalty: 0.0,
          presence_penalty: 0.0,
          stream: true,
          messages: [
            { role: 'system', content: 'You are a helpful assistant.' }
          ]
        });

        const response = ref('');
        const isLoading = ref(false);
        const tab = ref('preview');
        const showToken = ref(false);
        const responseTime = ref(0);
        const showProfilesModal = ref(false);
        const newProfileName = ref('');
        const savedProfiles = ref({});

        const notification = reactive({
          show: false,
          type: 'info',
          content: '',
          duration: 5000
        });

        // Common Models List
        const commonModels = ref([
          'gpt-3.5-turbo',
          'gpt-3.5-turbo-16k',
          'gpt-4',
          'gpt-4-turbo',
          'gpt-4-32k',
          'claude-3-sonnet',
          'claude-3-opus',
          'claude-3-haiku',
          'gemini-pro',
          'gemini-pro-vision',
          'llama-2-7b',
          'llama-2-13b',
          'llama-2-70b',
          'mistral-7b',
          'mixtral-8x7b',
          'codellama-34b',
          'text-davinci-003',
          'text-ada-001',
          'davinci-002'
        ]);

        // Computed Properties
        const responseStats = computed(() => {
          if (!response.value) return { characters: 0, words: 0 };
          return {
            characters: response.value.length,
            words: response.value.trim().split(/\s+/).length
          };
        });

        const canSendRequest = computed(() => {
          return !!(config.url.trim() && config.token.trim() && config.model.trim() && config.messages.length > 0);
        });

        // Local Storage Functions
        function saveToLocalStorage() {
          try {
            localStorage.setItem('ai-chat-config', JSON.stringify(config));
            localStorage.setItem('ai-chat-profiles', JSON.stringify(savedProfiles.value));
          } catch (e) {
            showNotification('error', 'Failed to save configuration to local storage');
          }
        }

        function loadFromLocalStorage() {
          try {
            const savedConfig = localStorage.getItem('ai-chat-config');
            const savedProfilesData = localStorage.getItem('ai-chat-profiles');

            if (savedConfig) {
              const parsedConfig = JSON.parse(savedConfig);
              Object.assign(config, parsedConfig);
            }

            if (savedProfilesData) {
              savedProfiles.value = JSON.parse(savedProfilesData);
            }
          } catch (e) {
            showNotification('error', 'Failed to load saved configuration');
          }
        }

        // Profile Management Functions
        function saveCurrentProfile() {
          const name = newProfileName.value.trim();
          if (!name) {
            showNotification('warning', 'Please enter a profile name');
            return;
          }

          const profileId = Date.now().toString();
          savedProfiles.value[profileId] = {
            name: name,
            config: JSON.parse(JSON.stringify(config)),
            timestamp: new Date().toISOString()
          };

          saveToLocalStorage();
          newProfileName.value = '';
          showNotification('success', `Profile "${name}" saved successfully`);
        }

        function loadProfile(profileConfig) {
          Object.assign(config, profileConfig);
          showProfilesModal.value = false;
          showNotification('success', 'Profile loaded successfully');
        }

        function deleteProfile(profileId) {
          if (confirm('Are you sure you want to delete this profile?')) {
            const profileName = savedProfiles.value[profileId].name;
            delete savedProfiles.value[profileId];
            saveToLocalStorage();
            showNotification('success', `Profile "${profileName}" deleted`);
          }
        }

        function resetConfiguration() {
          if (confirm('Are you sure you want to reset all configuration to defaults?')) {
            Object.assign(config, {
              url: 'https://api.openai.com',
              token: '',
              model: 'gpt-3.5-turbo',
              temperature: 0.7,
              max_tokens: 1000,
              top_p: 1.0,
              frequency_penalty: 0.0,
              presence_penalty: 0.0,
              stream: true,
              messages: [
                { role: 'system', content: 'You are a helpful assistant.' }
              ]
            });
            response.value = '';
            showNotification('success', 'Configuration reset to defaults');
          }
        }

        function exportConfiguration() {
          const exportData = {
            config: config,
            profiles: savedProfiles.value,
            timestamp: new Date().toISOString()
          };

          const blob = new Blob([JSON.stringify(exportData, null, 2)], {
            type: 'application/json'
          });

          const url = URL.createObjectURL(blob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `ai-chat-config-${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);

          showNotification('success', 'Configuration exported successfully');
        }

        function importConfiguration(event) {
          const file = event.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const importData = JSON.parse(e.target.result);

              if (importData.config) {
                Object.assign(config, importData.config);
              }

              if (importData.profiles) {
                Object.assign(savedProfiles.value, importData.profiles);
              }

              saveToLocalStorage();
              showNotification('success', 'Configuration imported successfully');
            } catch (error) {
              showNotification('error', 'Invalid configuration file format');
            }
          };
          reader.readAsText(file);

          // Clear the input
          event.target.value = '';
        }

        // Utility Functions
        function newMessage() {
          return { event: "", id: "", retry: undefined };
        }

        function concat(a, b) {
          const res = new Uint8Array(a.length + b.length);
          res.set(a);
          res.set(b, a.length);
          return res;
        }

        function getLines(onLine) {
          let buffer;
          let position;
          let fieldLength;
          let discardTrailingNewline = false;

          return function onChunk(arr) {
            if (buffer === undefined) {
              buffer = arr;
              position = 0;
              fieldLength = -1;
            } else {
              buffer = concat(buffer, arr);
            }

            const bufLength = buffer.length;
            let lineStart = 0;

            while (position < bufLength) {
              if (discardTrailingNewline) {
                if (buffer[position] === 10) {
                  lineStart = ++position;
                }
                discardTrailingNewline = false;
              }

              let lineEnd = -1;
              for (; position < bufLength && lineEnd === -1; ++position) {
                switch (buffer[position]) {
                  case 58:
                    if (fieldLength === -1) {
                      fieldLength = position - lineStart;
                    }
                    break;
                  case 13:
                    discardTrailingNewline = true;
                  case 10:
                    lineEnd = position;
                    break;
                }
              }

              if (lineEnd === -1) break;
              onLine(buffer.subarray(lineStart, lineEnd), fieldLength);
              lineStart = position;
              fieldLength = -1;
            }

            if (lineStart === bufLength) {
              buffer = undefined;
            } else if (lineStart !== 0) {
              buffer = buffer.subarray(lineStart);
              position -= lineStart;
            }
          };
        }

        function getMessages(onId, onRetry, onMessage) {
          let message = newMessage();
          const decoder = new TextDecoder();

          return function onLine(line, fieldLength) {
            if (line.length === 0) {
              onMessage?.(message);
              message = newMessage();
            } else if (fieldLength > 0) {
              const field = decoder.decode(line.subarray(0, fieldLength));
              const valueOffset = fieldLength + (line[fieldLength + 1] === 32 ? 2 : 1);
              const value = decoder.decode(line.subarray(valueOffset));

              switch (field) {
                case "data":
                  message.data = message.data ? message.data + "\n" + value : value;
                  break;
                case "event":
                  message.event = value;
                  break;
                case "id":
                  onId(message.id = value);
                  break;
                case "retry":
                  const retry = parseInt(value, 10);
                  if (!isNaN(retry)) {
                    onRetry(message.retry = retry);
                  }
                  break;
              }
            }
          };
        }

        function showNotification(type, content, duration = 5000) {
          notification.type = type;
          notification.content = content;
          notification.show = true;

          setTimeout(() => {
            notification.show = false;
          }, duration);
        }

        function formatDate(dateString) {
          return new Date(dateString).toLocaleDateString() + ' ' +
            new Date(dateString).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Message Functions
        function addMessage() {
          config.messages.push({ role: 'user', content: '' });
        }

        function removeMessage(index) {
          if (config.messages.length > 1) {
            config.messages.splice(index, 1);
          } else {
            showNotification('warning', 'At least one message is required');
          }
        }

        function duplicateMessage(index) {
          const originalMessage = config.messages[index];
          config.messages.push({
            role: originalMessage.role,
            content: originalMessage.content
          });
        }

        function clearAllMessages() {
          if (confirm('Are you sure you want to clear all messages?')) {
            config.messages = [{ role: 'system', content: 'You are a helpful assistant.' }];
          }
        }

        function formatJSON(text) {
          try {
            return JSON.stringify({ response: text }, null, 2);
          } catch {
            return text;
          }
        }

        function copyToClipboard() {
          if (!response.value) return;

          navigator.clipboard.writeText(response.value).then(() => {
            showNotification('success', 'Response copied to clipboard');
          }).catch(() => {
            showNotification('error', 'Failed to copy to clipboard');
          });
        }

        function clearResponse() {
          response.value = '';
          responseTime.value = 0;
        }

        async function sendRequest() {
          if (!canSendRequest.value) {
            showNotification('warning', 'Please fill in all required fields');
            return;
          }

          let { url, token, model, messages, temperature, stream, max_tokens, top_p, frequency_penalty, presence_penalty } = config;

          url = url.trim();
          token = token.trim();
          model = model.trim();

          if (!url.endsWith("/v1/chat/completions")) {
            if (url.endsWith("/")) {
              url = url + "v1/chat/completions";
            } else {
              url = url + "/v1/chat/completions";
            }
          }

          isLoading.value = true;
          tab.value = 'preview';
          response.value = '';
          const startTime = Date.now();

          const requestBody = {
            model,
            messages,
            temperature,
            stream,
            max_tokens,
            top_p,
            frequency_penalty,
            presence_penalty
          };

          try {
            if (stream) {
              const result = await fetch(url, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(requestBody)
              });

              if (!result.ok) {
                const errorText = await result.text();
                showNotification('error', `HTTP error! Status: ${result.status} - ${errorText}`, 10000);
                return;
              }

              if (!result || !result.body) {
                showNotification('error', 'Unexpected error: No response body', 10000);
                return;
              }

              const reader = result.body.getReader();
              let events = [];
              const onChunk = getLines(getMessages(
                () => { },
                () => { },
                (event) => events.push(event)
              ));

              try {
                while (true) {
                  const { done, value } = await reader.read();
                  if (done) break;
                  onChunk(value);

                  for (const event of events) {
                    if (event.data && event.data.length > 0) {
                      if (event.data === "[DONE]") break;

                      try {
                        const data = JSON.parse(event.data);

                        if (typeof data === "object" && data !== null && "error" in data) {
                          const errorStr = typeof data.error === "string" ? data.error :
                            typeof data.error === "object" && data.error && "message" in data.error &&
                              typeof data.error.message === "string" ? data.error.message :
                              JSON.stringify(data.error);
                          throw new Error(`Error from API: ` + errorStr);
                        }

                        const content = data['choices']?.[0]?.['delta']?.['content'];
                        if (content) {
                          response.value += content;
                        }
                      } catch (parseError) {
                        console.error('Parse error:', parseError);
                      }
                    }
                  }
                  events = [];
                }
              } catch (streamError) {
                console.error('Stream error:', streamError);
                showNotification('error', 'Streaming error: ' + streamError.message);
              } finally {
                reader.releaseLock();
              }
            } else {
              const result = await fetch(url, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(requestBody)
              });

              if (!result.ok) {
                const errorText = await result.text();
                showNotification('error', `HTTP error! Status: ${result.status} - ${errorText}`, 10000);
                return;
              }

              const data = await result.json();
              if (data.choices && data.choices.length > 0) {
                response.value = data.choices[0].message.content;
              } else {
                showNotification('error', 'Invalid API response format', 10000);
              }
            }

            responseTime.value = Date.now() - startTime;
            showNotification('success', 'Request completed successfully');
          } catch (error) {
            console.error('Request error:', error);
            showNotification('error', error.message || 'Request failed', 10000);
          } finally {
            isLoading.value = false;
          }
        }

        // Watchers
        watch(config, () => {
          saveToLocalStorage();
        }, { deep: true });

        // Lifecycle
        onMounted(() => {
          loadFromLocalStorage();
        });

        return {
          config,
          response,
          isLoading,
          tab,
          showToken,
          responseTime,
          notification,
          responseStats,
          canSendRequest,
          showProfilesModal,
          newProfileName,
          savedProfiles,
          commonModels,
          addMessage,
          removeMessage,
          duplicateMessage,
          clearAllMessages,
          sendRequest,
          formatJSON,
          copyToClipboard,
          clearResponse,
          saveCurrentProfile,
          loadProfile,
          deleteProfile,
          resetConfiguration,
          exportConfiguration,
          importConfiguration,
          formatDate
        };
      }
    }).mount('#app');
  </script>
</body>

</html>